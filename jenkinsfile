pipeline {
    agent any
    
    stages {
        stage('Ensure clean workspace'){
            steps {
                script {
                    getBuildUser()
                    currentBuild.displayName = "#${currentBuild.number} | ${env.BUILD_USER} | ${params.BRANCH}" 
                    deleteDir()
                }
            }
        }
        stage('Checkout Japplication'){
            steps {
                script {
                    checkout(
                        [
                            $class: 'GitSCM', 
                            branches: 
                            [
                                [name: "main"]
                            ], 
                            doGenerateSubmoduleConfigurations: false, 
                            extensions: [], 
                            submoduleCfg: [], 
                            userRemoteConfigs: 
                            [
                                [
                                    credentialsId: 'gitpass', 
                                    url: "https://github.com/koppularajender/Japplication.git"
                                ]
                            ]
                        ]
                    )
                }
            }
        }
        stage ('Initialize') {
            steps {
                sh '''
                    echo "PATH = ${PATH}"
                    echo "M2_HOME = ${M2_HOME}"
                '''
            }
        }

        stage ('Build') {
            steps {
                sh 'mvn -Dmaven.test.failure.ignore=true install'
            }
            post {
                success {
                    junit 'target/surefire-reports/**/*.xml' 
                }
            }
        }
    }
}
